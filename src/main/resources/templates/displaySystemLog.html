<!DOCTYPE html>
<html lang="en">
<head>
    <!--<base href="${request.scheme+'://'+request.serverName+':'+request.serverPort+'/'+ctxPath}"/>-->
    <meta charset="utf-8">
    <script src="https://cdn.bootcss.com/angular.js/1.6.3/angular.min.js"></script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta productName="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta productName="description" content="CoreUI - Open Source Bootstrap Admin Template">
    <meta productName="author" content="Łukasz Holeczek">
    <meta productName="keyword"
          content="Bootstrap,Admin,Template,Open,Source,AngularJS,Angular,Angular2,Angular 2,Angular4,Angular 4,jQuery,CSS,HTML,RWD,Dashboard,React,React.js,Vue,Vue.js">
    <link rel="shortcut icon" href="img/favicon.png">
    <title>HSBC后台产品管理</title>

    <!-- Icons -->
    <link href="vendors/css/flag-icon.min.css" rel="stylesheet">
    <link href="vendors/css/font-awesome.min.css" rel="stylesheet">
    <link href="vendors/css/simple-line-icons.min.css" rel="stylesheet">
    <!-- Main styles for this application -->
    <link href="css/style.css" rel="stylesheet">
    <!--<link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">-->

    <script src="https://cdn.bootcss.com/angular.js/1.5.5/angular.min.js"></script>
    <script src="https://cdn.bootcss.com/angular-ui-bootstrap/0.11.2/ui-bootstrap-tpls.min.js"></script>
    <!--ng-controller="modelcontroller"-->
</head>
<body class="app header-fixed sidebar-fixed aside-menu-fixed aside-menu-hidden" ng-app="app"
      ng-controller="customersCtrl">
<header class="app-header navbar">
    <h4 style="margin: auto">系统日志查看</h4>
    <ul class="nav navbar-nav ml-auto">

        <li class="nav-item dropdown">
            <a class="nav-link" data-toggle="dropdown" href="#" role="button" aria-haspopup="true"
               aria-expanded="false">
                <img id="adminImage" src="img/avatars/6.jpg" class="img-avatar">
            </a>
            <div class="dropdown-menu dropdown-menu-right">
                <a class="dropdown-item" id="showAdminMessage" href="#" data-toggle="modal" data-target="#adminModal"
                   data-whatever="1"><i class="fa fa-user"></i>个人信息</a>
                <a class="dropdown-item" href="#" data-toggle="modal" data-target="#updateAdminPasswordModal"><i
                        class="fa fa-wrench"></i>修改密码</a>
                <a class="dropdown-item" href="#"><i class="fa fa-file"></i>退出</a>
            </div>
        </li>
    </ul>
</header>

<div class="app-body">
    <div class="sidebar">
        <nav class="sidebar-nav">
            <ul class="nav">
                <li class="nav-title">
                    HSBC产品管理
                </li>
                <li class="nav-item">
                    <a href="/manager-index" class="nav-link"><i class="fa fa-user-circle-o"></i> 理财产品管理</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link"><i class="fa fa-gear"></i>系统日志</a>
                </li>
            </ul>
        </nav>
        <button class="sidebar-minimizer brand-minimizer" type="button"></button>
    </div>
    <!-- Main content -->
    <main class="main">
        <!-- Breadcrumb -->
        <ol class="breadcrumb">
            <li class="breadcrumb-item">>系统日志</li>
        </ol>
        <!--查询输入框-->
        <div class="row">
            <div class="col-md-6 col-md-offset-3">
                <div class="input-prepend input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text"><i class="fa fa-search"></i></span>
                    </div>
                    <input id="search_name" class="form-control" size="16" type="text" placeholder="请输入查询信息">
                    <span class="input-group-append">
                <button id="search" class="btn btn-info" type="button">查询</button>
              </span>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header container">

                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-12">
                                <button style="float: right" type="button" class="btn btn-primary"
                                        data-toggle="modal"
                                        data-target="#infoModal">
                                    导出系统日志
                                </button>
                            </div>
                        </div>
                        <table class="table table-responsive-sm table-bordered table-striped table-sm">
                            <thead>
                            <tr>
                                <th>序号</th>
                                <th>操作者</th>
                                <th>操作时间</th>
                                <th>具体操作</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="systemLog in systemLogs">
                                <td ng-bind="$index+1"></td>
                                <td ng-bind="systemLog.name"></td>
                                <td ng-bind="systemLog.time"></td>
                                <td ng-bind="systemLog.operation"></td>
                            </tr>
                            </tbody>
                        </table>
                        <nav>
                            <ul class="pagination">
                                <li class="page-item"><a class="page-link" ng-model="totalElements">总共{{totalElements}}条数据</a>
                                </li>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                <li class="page-item"><a class="page-link" ng-model="totalPages">总共{{totalPages}}页</a>
                                </li>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                <li class="page-item"><a class="page-link" ng-model="pageNumber"
                                                         ng-click="pageFunction(0)">首页</a></li>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                <li class="page-item"><a class="page-link" ng-model="pageNumber"
                                                         ng-click="pageFunction(pageNumber-1)">上一页</a></li>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                <li class="page-item"><a class="page-link" ng-model="pageNumber"
                                                         ng-click="pageFunction(pageNumber+1)">下一页</a></li>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                <li class="page-item"><a class="page-link" ng-model="lastPage"
                                                         ng-click="pageFunction(lastPage-1)">尾页</a></li>

                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>

    </main>

</div>

<footer class="app-footer">
    <span><a href="http://coreui.io">Team-Three</a> © 2018 creativeLabs.</span>
    <span class="ml-auto">Powered by <a href="http://coreui.io">Team-Three</a></span>
</footer>

<div class="modal fade" id="infoModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="display: none;"
     aria-hidden="true">
    <div class="modal-dialog modal-info" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Output SystemLog</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Please Choose Data</p>
                <div class="container">
                    <div class="row">

                            <div class="col-3">
                          <span>
                              <input type="radio" id="fiveDays" name="radio" class="radio_sync" value="5"/>Five Days
                         </span>
                            </div>
                            <div class="col-4">
                          <span>
                              <input type="radio" id="fifteenDays" name="radio" class="radio_sync" value="15"/>Fifteen Days
                         </span>
                            </div>
                        <div class="col-5">
                          <span>
                             自定义 ：<input type="text" id="MySelect" size="10px" class="radio_sync"/>
                         </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" ng-click="clearChoose()">Clear Choose</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-info" ng-click="OutputSystemLog()">Save changes</button>

            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal-dialog -->
</div>


<!-- Bootstrap and necessary plugins -->
<script src="vendors/js/jquery.min.js"></script>
<script src="vendors/js/popper.min.js"></script>
<script src="vendors/js/bootstrap.min.js"></script>
<script src="vendors/js/pace.min.js"></script>
<!-- Plugins and scripts required by all views -->
<script src="vendors/js/Chart.min.js"></script>
<!-- CoreUI main scripts -->

<script type="text/javascript">

    var app = angular.module('app', ['ui.bootstrap']);
    app.controller("customersCtrl", function ($scope, $http) {
        $http({
            method: 'get',
            url: "/get/system/log/list"
        })
            .then(function success(result) {
                    $scope.systemLogs = result.data.content;
                    //总页数
                    $scope.totalPages = result.data.totalPages

                    //总共有多少条记录
                    $scope.totalElements = result.data.totalElements
                    //当前页数
                    $scope.currentPage = result.data.number;
                    //用于控制上一页。下一页
                    $scope.pageNumber = result.data.pageable.pageNumber

                    //总页数
                    totlePageNumber = result.data.totalPages

                    //用于控制尾页
                    $scope.lastPage = result.data.totalPages

                },
                function error() {
                    alert("出错了")
                }
            );

        //控制分页显示函数  pageFunction：选择上一页、下一页；getDataNumberOrProductType：获取产品类型，分类型展示、获取页面显示多少条数量
        $scope.pageFunction = function (pageNumber) {
            if (pageNumber >= totlePageNumber) {
                alert("没有下一页了");
                return false;
            }
            if (pageNumber < 0) {
                alert("没有上一页了");
                return false;
            }
            var jsonData = {"pageNumber": pageNumber};
            $http({
                url: "/manager/productlist",
                method: "post",
                data: jsonData,
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                transformRequest: function (obj) {
                    var str = [];
                    for (var p in obj) {
                        str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
                    }
                    return str.join("&");
                }
            }).then(function (result) {
                //后台返回的数据
                $scope.systemLogs = result.data.content;
                //总页数
                $scope.totalPages = result.data.totalPages
                //总共有多少条记录
                $scope.totalElements = result.data.totalElements
                //当前页数
                $scope.currentPage = result.data.number;
                //用于控制上一页。下一页
                $scope.pageNumber = result.data.pageable.pageNumber
                totlePageNumber = result.data.totalPages

            })
        }

        //根据选择的数据显示数量，从新获取数据
        $scope.getDataNumberOrProductType = function () {
            var productType = $("#productType").find("option:selected").text();//选中的文本
            var dataNumber = $("#dataNumber").find("option:selected").text();//选中的文本
            var jsonData = {"dataCount": dataNumber, "productType": productType};
            $http({
                url: "/manager/productlist",
                method: "post",
                data: jsonData,
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                transformRequest: function (obj) {
                    var str = [];
                    for (var p in obj) {
                        str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
                    }
                    return str.join("&");
                }
            })
                .then(function (result) {
                    //后台返回的数据
                    $scope.systemLogs = result.data.content;
                    //总页数
                    $scope.totalPages = result.data.totalPages

                    //总共有多少条记录
                    $scope.totalElements = result.data.totalElements
                    //当前页数
                    $scope.currentPage = result.data.number;
                    //用于控制上一页。下一页
                    $scope.pageNumber = result.data.pageable.pageNumber
                    totlePageNumber = result.data.totalPages
                })
        }

        /*clear choose*/
        $scope.clearChoose = function () {
            document.getElementById("MySelect").value = "";
            var x=document.getElementsByName("radio");
            for(var i=0;i<x.length;i++){ //对所有结果进行遍历，如果状态是被选中的，则将其选择取消
                if (x[i].checked==true)
                {
                    x[i].checked=false;
                }
            }

        }

        $scope.OutputSystemLog = function () {
            var mychoose;
            var MySelect;
            var checkvale = "undefined";
            // MySelect = $("#MySelect").val();
            MySelect = document.getElementById("MySelect").value
            checkvale = $('input:radio:checked').val();
            if (checkvale != "undefined") {
                mychoose = checkvale;
            }
            if (MySelect != "") {
                mychoose = MySelect;
            }
            if (MySelect != "" && checkvale != "undefined") {
                alert("只能选择一个日期")
                return
            }
            if (MySelect == "" && checkvale == "undefined") {
                alert("请选择一个日期")
                return
            }
            Number(mychoose)
            var data = new Object;
            data.n = mychoose;
            $("#infoModal").modal('hide');
            window.open("http://localhost:8080/export/systemlog?n=" + mychoose + "")
        }

    });


</script>

</body>

</html>